<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>COGTEST</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;900&family=JetBrains+Mono:wght@300;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg-dark: #08080a;
            --bg-panel: #111114;
            --primary: #ffffff;
            --accent: #00f2ff;
            --accent-dim: rgba(0, 242, 255, 0.1);
            --danger: #ff2a2a;
            --success: #00ff88;
            --warning: #ffdd00;
            --text-muted: #555;
            --font-display: 'Inter', sans-serif;
            --font-mono: 'JetBrains Mono', monospace;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; user-select: none; }

        body {
            background-color: var(--bg-dark);
            color: var(--primary);
            font-family: var(--font-display);
            height: 100vh;
            width: 100vw;
            overflow: hidden;
        }

        #menu-view {
            display: flex;
            width: 100%;
            height: 100%;
            transition: transform 0.4s cubic-bezier(0.2, 0, 0, 1);
        }

        .menu-panel {
            flex: 1;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: all 0.4s ease;
            position: relative;
            border-right: 1px solid #222;
        }
        
        .menu-panel:last-child { border-right: none; }

        .menu-panel:hover {
            flex: 1.5;
            background: var(--accent-dim);
        }
        
        .menu-panel:hover h2 { color: var(--accent); transform: scale(1.1); }
        .menu-panel:hover .panel-icon { transform: scale(1.2) rotate(-5deg); opacity: 1; }

        .panel-content { text-align: center; z-index: 2; pointer-events: none; }
        
        .panel-icon {
            font-size: 6rem;
            margin-bottom: 2rem;
            opacity: 0.3;
            transition: all 0.4s ease;
        }

        h2 {
            font-size: 3rem;
            text-transform: uppercase;
            font-weight: 900;
            letter-spacing: -2px;
            transition: color 0.3s;
        }

        p {
            font-family: var(--font-mono);
            color: var(--text-muted);
            margin-top: 1rem;
            letter-spacing: 1px;
            font-size: 0.8rem;
        }

        #game-layer {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: var(--bg-dark);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            opacity: 0;
            pointer-events: none;
            transform: scale(0.95);
            transition: all 0.3s cubic-bezier(0.2, 0, 0, 1);
            z-index: 10;
        }

        #game-layer.active {
            opacity: 1;
            pointer-events: all;
            transform: scale(1);
        }

        .hud-top {
            position: absolute;
            top: 40px;
            width: 100%;
            text-align: center;
            font-family: var(--font-mono);
            color: var(--text-muted);
            letter-spacing: 2px;
            text-transform: uppercase;
            font-size: 0.9rem;
        }

        .hud-bottom {
            position: absolute;
            bottom: 40px;
            width: 100%;
            text-align: center;
            font-family: var(--font-mono);
            color: var(--text-muted);
            font-size: 0.8rem;
            opacity: 0.5;
        }

        .key-badge {
            border: 1px solid #444;
            padding: 2px 8px;
            border-radius: 4px;
            margin: 0 4px;
            color: #fff;
            display: inline-block;
        }

        .hero-text {
            font-family: var(--font-mono);
            font-size: 12vw; 
            font-weight: 700;
            line-height: 1;
            margin: 0;
            transition: color 0.1s;
        }

        .sub-text {
            font-size: 1.5rem;
            margin-top: 2rem;
            color: var(--text-muted);
        }

        #game-layer.reflex-waiting { background-color: #1a0a0a; cursor: none; }
        #game-layer.reflex-go { background-color: var(--success); cursor: pointer; transition: none; }
        #game-layer.reflex-fail { background-color: var(--danger); }
        #game-layer.reflex-go .hero-text { color: #000; transition: none; }
        #game-layer.reflex-go .sub-text { color: #000; opacity: 0.7; }

        #game-layer.focus-hit .hero-text { color: var(--success); text-shadow: 0 0 30px var(--success); }
        #game-layer.focus-miss .hero-text { color: var(--danger); text-shadow: 0 0 30px var(--danger); }

        .c-red { color: var(--danger) !important; }
        .c-green { color: var(--success) !important; }
        .c-blue { color: #4488ff !important; } 
        .c-yellow { color: var(--warning) !important; }
        
        .hidden { display: none !important; }
        .text-accent { color: var(--accent) !important; }
        .text-success { color: var(--success) !important; }
        .text-danger { color: var(--danger) !important; }

    </style>
</head>
<body>

    <div id="menu-view">
        <div class="menu-panel" onclick="app.loadGame('perception')">
            <div class="panel-content">
                <div class="panel-icon">‚è≥</div>
                <h2>Chrono</h2>
                <p>INTERNAL CLOCK</p>
            </div>
        </div>
        <div class="menu-panel" onclick="app.loadGame('reflex')">
            <div class="panel-content">
                <div class="panel-icon">‚ö°</div>
                <h2>Reflex</h2>
                <p>REACTION SPEED</p>
            </div>
        </div>
        <div class="menu-panel" onclick="app.loadGame('focus')">
            <div class="panel-content">
                <div class="panel-icon">üëÅÔ∏è</div>
                <h2>Signal</h2>
                <p>PATTERN MATCH</p>
            </div>
        </div>
        <div class="menu-panel" onclick="app.loadGame('conflict')">
            <div class="panel-content">
                <div class="panel-icon">üß†</div>
                <h2>Conflict</h2>
                <p>INHIBITION</p>
            </div>
        </div>
        <div class="menu-panel" onclick="app.loadGame('sequence')">
            <div class="panel-content">
                <div class="panel-icon">üí†</div>
                <h2>Sequence</h2>
                <p>MEMORY SPAN</p>
            </div>
        </div>
    </div>

    <div id="game-layer">
        
        <div class="hud-top">
            <span id="game-title-display">GAME NAME</span>
        </div>

        <div id="game-content">
            <h1 id="main-display" class="hero-text">0.00</h1>
            <div id="sub-display" class="sub-text">Press Space</div>
        </div>

        <div class="hud-bottom">
            <span id="control-hint">Press <span class="key-badge">SPACE</span> to Action</span> ‚Ä¢ Press <span class="key-badge">ESC</span> to Menu
        </div>

    </div>

<script>
    const app = {
        currentContext: 'menu',
        gameLayer: document.getElementById('game-layer'),
        titleDisplay: document.getElementById('game-title-display'),
        mainDisplay: document.getElementById('main-display'),
        subDisplay: document.getElementById('sub-display'),
        controlHint: document.getElementById('control-hint'),
        
        loadGame: function(gameType) {
            this.currentContext = gameType;
            this.gameLayer.classList.add('active');
            
            this.gameLayer.className = 'active'; 
            this.mainDisplay.style.color = '';
            this.mainDisplay.style.textShadow = '';
            this.mainDisplay.style.opacity = ''; 
            this.mainDisplay.className = 'hero-text';

            if (gameType === 'perception') {
                this.titleDisplay.innerText = "Chrono";
                this.controlHint.innerHTML = `Use <span class="key-badge">‚Üë</span> <span class="key-badge">‚Üì</span> to Adjust Time ‚Ä¢ <span class="key-badge">SPACE</span> to Start`;
                perceptionGame.init();
            } else if (gameType === 'reflex') {
                this.titleDisplay.innerText = "Reflex";
                this.controlHint.innerHTML = `Press <span class="key-badge">SPACE</span> to Action`;
                reflexGame.init();
            } else if (gameType === 'focus') {
                this.titleDisplay.innerText = "Signal";
                this.controlHint.innerHTML = `Press <span class="key-badge">SPACE</span> on Match`;
                focusGame.init();
            } else if (gameType === 'conflict') {
                this.titleDisplay.innerText = "Conflict";
                this.controlHint.innerHTML = `<span class="key-badge">‚Üê</span> NO ‚Ä¢ <span class="key-badge">‚Üí</span> YES ‚Ä¢ <span class="key-badge">SPACE</span> to Start`;
                conflictGame.init();
            } else if (gameType === 'sequence') {
                this.titleDisplay.innerText = "Sequence";
                this.controlHint.innerHTML = `Watch Pattern ‚Ä¢ Repeat with <span class="key-badge">ARROWS</span>`;
                sequenceGame.init();
            }
        },

        goHome: function() {
            this.currentContext = null;

            clearTimeout(reflexGame.timeoutId);
            clearTimeout(focusGame.intervalId);
            clearInterval(conflictGame.timerInterval);
            clearTimeout(sequenceGame.timeoutId);
            
            focusGame.state = 'idle';
            reflexGame.state = 'idle';
            conflictGame.state = 'idle';
            sequenceGame.state = 'idle';

            this.gameLayer.classList.remove('active');
            
            setTimeout(() => {
                this.currentContext = 'menu';
                this.gameLayer.className = ''; 
            }, 300);
        }
    };

    document.addEventListener('keydown', (e) => {
        if (app.currentContext === null) return;

        if (e.code === 'Escape') {
            app.goHome();
            return;
        }

        if (e.code === 'Space') {
            e.preventDefault(); 
            if (app.currentContext === 'perception') perceptionGame.action();
            if (app.currentContext === 'reflex') reflexGame.action();
            if (app.currentContext === 'focus') focusGame.action();
            if (app.currentContext === 'conflict') conflictGame.action();
            if (app.currentContext === 'sequence') sequenceGame.action();
        }

        // Consolidated Arrow Key Handling
        if (['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'].includes(e.code)) {
            e.preventDefault();

            // Perception Game Arrows
            if (app.currentContext === 'perception') {
                if (e.code === 'ArrowUp' || e.code === 'ArrowRight') perceptionGame.adjustTime(1);
                if (e.code === 'ArrowDown' || e.code === 'ArrowLeft') perceptionGame.adjustTime(-1);
            }
            
            // Conflict Game Arrows
            if (app.currentContext === 'conflict') {
                if (e.code === 'ArrowLeft') conflictGame.input(false);
                if (e.code === 'ArrowRight') conflictGame.input(true);
            }

            // Sequence Game Arrows
            if (app.currentContext === 'sequence') {
                sequenceGame.input(e.code);
            }
        }
    });

    document.addEventListener('mousedown', (e) => {
        if (app.currentContext === null) return;
        if (app.currentContext === 'reflex') reflexGame.action();
        if (app.currentContext === 'focus') focusGame.action();
    });

    const perceptionGame = {
        state: 'idle', 
        startTime: 0,
        targetTime: 0,
        selectedSeconds: 5,
        
        init: function() {
            this.selectedSeconds = 5; 
            this.reset();
        },

        reset: function() {
            this.state = 'idle';
            this.targetTime = this.selectedSeconds * 1000;
            app.mainDisplay.innerText = this.selectedSeconds + ".00";
            app.mainDisplay.style.opacity = "1";
            app.mainDisplay.style.color = "var(--primary)";
            app.subDisplay.innerHTML = "Target Time";
        },

        adjustTime: function(delta) {
            if (this.state !== 'idle') return;
            this.selectedSeconds += delta;
            if (this.selectedSeconds < 1) this.selectedSeconds = 1;
            if (this.selectedSeconds > 60) this.selectedSeconds = 60;
            this.reset(); 
        },

        action: function() {
            if (this.state === 'idle') this.start();
            else if (this.state === 'running') this.stop();
            else this.reset();
        },

        start: function() {
            this.state = 'running';
            this.startTime = Date.now();
            app.mainDisplay.style.opacity = "0.1"; 
            app.subDisplay.innerText = "Counting...";
        },

        stop: function() {
            this.state = 'ended';
            const elapsed = Date.now() - this.startTime;
            const diff = elapsed - this.targetTime;
            const elapsedSec = (elapsed / 1000).toFixed(3);
            const diffSec = (diff / 1000).toFixed(3);
            const sign = diff > 0 ? "+" : "";

            app.mainDisplay.style.opacity = "1";
            app.mainDisplay.innerText = elapsedSec;
            
            let color = "var(--danger)";
            let msg = "Way off";
            if (Math.abs(diff) < 200) { color = "var(--success)"; msg = "Perfect"; }
            else if (Math.abs(diff) < 500) { color = "var(--accent)"; msg = "Close"; }
            
            app.mainDisplay.style.color = color;
            app.subDisplay.innerHTML = `${msg} <span style="color:${color}">(${sign}${diffSec}s)</span> <br><br> Space to Retry`;
        }
    };

    const reflexGame = {
        state: 'idle',
        timeoutId: null,
        startTime: 0,

        init: function() {
            this.state = 'idle';
            app.gameLayer.className = 'active'; 
            app.mainDisplay.innerText = "READY?";
            app.mainDisplay.style.fontSize = "12vw";
            app.subDisplay.innerText = "Press Space to start sequence";
        },

        action: function() {
            if (this.state === 'idle') this.startWait();
            else if (this.state === 'waiting') this.fail();
            else if (this.state === 'ready') this.success();
            else if (this.state === 'result') this.init();
        },

        startWait: function() {
            this.state = 'waiting';
            app.gameLayer.classList.add('reflex-waiting');
            app.mainDisplay.innerText = "WAIT";
            app.subDisplay.innerText = "Steady...";
            const delay = Math.floor(Math.random() * 3000) + 2000;
            this.timeoutId = setTimeout(() => {
                if(this.state === 'waiting') this.go(); 
            }, delay);
        },

        fail: function() {
            clearTimeout(this.timeoutId);
            this.state = 'result';
            app.gameLayer.className = 'active reflex-fail';
            app.mainDisplay.innerText = "TOO EARLY";
            app.subDisplay.innerText = "Space to retry";
        },

        go: function() {
            this.state = 'ready';
            this.startTime = Date.now();
            app.gameLayer.className = 'active reflex-go';
            app.mainDisplay.innerText = "CLICK!";
            app.subDisplay.innerText = "";
        },

        success: function() {
            const time = Date.now() - this.startTime;
            this.state = 'result';
            app.gameLayer.className = 'active'; 
            app.mainDisplay.innerText = time + "ms";
            let rank = "Average";
            if (time < 200) rank = "Cybernetic";
            else if (time < 250) rank = "Pro Gamer";
            app.subDisplay.innerHTML = `Rank: <span class="text-accent">${rank}</span><br><br>Space to Retry`;
        }
    };

    const focusGame = {
        state: 'idle', 
        intervalId: null,
        targetSymbol: '',
        chars: 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789',
        currentSymbol: '',
        integrity: 1, 
        score: 0,
        speed: 800,
        lastWasTarget: false,
        clickedThisTurn: false,
        isFirstTurn: false, 

        init: function() {
            this.state = 'idle';
            this.integrity = 1; 
            this.score = 0;
            this.speed = 800;
            this.lastWasTarget = false;
            this.currentSymbol = ''; 
            this.targetSymbol = this.chars[Math.floor(Math.random() * this.chars.length)];
            
            app.gameLayer.className = 'active'; 
            app.mainDisplay.innerText = `[ ${this.targetSymbol} ]`;
            app.mainDisplay.style.color = "var(--accent)";
            app.subDisplay.innerText = "Press Space only on TARGET";
        },

        action: function() {
            if (this.state === 'idle') this.start();
            else if (this.state === 'running') this.checkInput();
            else if (this.state === 'ended') this.init();
        },

        start: function() {
            this.state = 'running';
            this.isFirstTurn = true; 
            this.nextTurn();
        },

        nextTurn: function() {
            if (this.state !== 'running') return;

            app.gameLayer.className = 'active';

            if (this.lastWasTarget && !this.clickedThisTurn) {
                this.damage('MISS');
                if (this.state === 'ended') return;
            }

            this.clickedThisTurn = false;
            const previousSymbol = this.currentSymbol;
            let isTarget = Math.random() < 0.25;

            if (this.isFirstTurn) {
                isTarget = false;
                this.isFirstTurn = false;
            }
            if (isTarget && previousSymbol === this.targetSymbol) {
                isTarget = false; 
            }

            this.lastWasTarget = isTarget;
            
            if (isTarget) {
                this.currentSymbol = this.targetSymbol;
            } else {
                let char;
                do {
                    char = this.chars[Math.floor(Math.random() * this.chars.length)];
                } while (char === this.targetSymbol || char === previousSymbol);
                this.currentSymbol = char;
            }

            app.mainDisplay.innerText = this.currentSymbol;
            app.mainDisplay.style.color = "var(--primary)";
            app.subDisplay.innerText = `SCORE: ${this.score}`;

            const currentSpeed = Math.max(250, this.speed - (this.score * 15));
            this.intervalId = setTimeout(() => this.nextTurn(), currentSpeed);
        },

        checkInput: function() {
            if (this.clickedThisTurn) return;
            this.clickedThisTurn = true;

            if (this.currentSymbol === this.targetSymbol) {
                this.score++;
                app.gameLayer.classList.add('focus-hit');
                app.subDisplay.innerText = `SCORE: ${this.score}`;
            } else {
                this.damage('FALSE');
            }
        },

        damage: function(reason) {
            this.integrity--;
            app.gameLayer.classList.add('focus-miss');
            app.subDisplay.innerText = `${reason}!`;
            if (this.integrity <= 0) {
                this.endGame();
            }
        },

        endGame: function() {
            this.state = 'ended';
            clearTimeout(this.intervalId);
            app.gameLayer.className = 'active reflex-fail';
            app.mainDisplay.innerText = "LOST";
            app.subDisplay.innerHTML = `Space to Retry`;
        }
    };

    const conflictGame = {
        state: 'idle',
        score: 0,
        endTime: 0, 
        timerInterval: null,
        currentMatch: false, 
        
        colors: [
            { name: 'RED', class: 'c-red' },
            { name: 'GREEN', class: 'c-green' },
            { name: 'BLUE', class: 'c-blue' },
            { name: 'YELLOW', class: 'c-yellow' }
        ],

        init: function() {
            this.state = 'idle';
            this.score = 0;
            
            app.gameLayer.className = 'active';
            app.mainDisplay.innerHTML = '<span class="text-accent">CONFLICT</span>';
            app.mainDisplay.style.fontSize = "8vw";
            app.subDisplay.innerText = "Does Text match Color?";
        },

        action: function() {
            if (this.state === 'running') return; 

            if (this.state === 'idle') {
                this.startGame();
            } else if (this.state === 'ended') {
                this.init(); 
            }
        },

        input: function(decision) {
            if (this.state !== 'running') return;

            if (decision === this.currentMatch) {
                this.score++;
                this.nextTurn();
            } else {
                this.endGame(true); 
            }
        },

        startGame: function() {
            this.state = 'running';
            this.score = 0;
            this.endTime = Date.now() + 30000; 
            
            app.mainDisplay.style.fontSize = "12vw";
            
            this.timerInterval = setInterval(() => {
                const now = Date.now();
                const remaining = Math.max(0, this.endTime - now);
                const secondsLeft = (remaining / 1000).toFixed(1);

                app.subDisplay.innerText = `TIME: ${secondsLeft}s // SCORE: ${this.score}`;
                
                if (remaining <= 0) {
                    this.endGame(false); 
                }
            }, 100);

            this.nextTurn();
        },

        nextTurn: function() {
            const wordObj = this.colors[Math.floor(Math.random() * this.colors.length)];
            this.currentMatch = Math.random() < 0.5;
            
            let colorObj;
            if (this.currentMatch) {
                colorObj = wordObj;
            } else {
                do {
                    colorObj = this.colors[Math.floor(Math.random() * this.colors.length)];
                } while (colorObj.name === wordObj.name);
            }

            app.mainDisplay.innerText = wordObj.name;
            app.mainDisplay.className = `hero-text ${colorObj.class}`;
        },

        endGame: function(isWrongInput) {
            this.state = 'ended';
            clearInterval(this.timerInterval);

            if (isWrongInput) {
                this.score = 0;
            }

            app.mainDisplay.className = 'hero-text'; 

            if (isWrongInput) {
                app.gameLayer.className = 'active reflex-fail';
                app.mainDisplay.style.color = 'var(--primary)'; 
            } else {
                app.gameLayer.className = 'active';
                app.mainDisplay.style.color = 'var(--primary)';
            }
            
            app.mainDisplay.innerText = isWrongInput ? "WRONG" : "DONE";
            
            if (isWrongInput) {
                app.subDisplay.innerHTML = `<br>Space to Retry`;
            } else {
                app.subDisplay.innerHTML = `Final Score: <span class="text-accent">${this.score}</span><br><br>Space to Retry`;
            }
        }
    };

    const sequenceGame = {
        state: 'idle', // idle, showing, input, ended
        sequence: [],
        userIndex: 0,
        level: 1,
        timeoutId: null,
        
        // Use rotation values instead of different characters to ensure identical size
        arrows: {
            'ArrowUp': '0deg',
            'ArrowDown': '180deg',
            'ArrowLeft': '-90deg',
            'ArrowRight': '90deg'
        },

        init: function() {
            this.state = 'idle';
            this.level = 1;
            app.gameLayer.className = 'active';
            app.mainDisplay.innerText = "MEMORIZE";
            app.mainDisplay.style.fontSize = "8vw";
            app.subDisplay.innerText = "Press Space to Start";
        },

        action: function() {
            if (this.state === 'idle') this.startLevel();
            else if (this.state === 'ended') this.init();
        },

        startLevel: function() {
            this.state = 'showing';
            this.sequence = [];
            this.userIndex = 0;
            app.subDisplay.innerText = `LEVEL ${this.level}`;
            
            // Generate sequence
            const keys = Object.keys(this.arrows);
            for(let i=0; i < this.level + 2; i++) {
                this.sequence.push(keys[Math.floor(Math.random() * keys.length)]);
            }

            this.playSequence(0);
        },

        playSequence: function(index) {
            if (index >= this.sequence.length) {
                app.mainDisplay.innerText = "?";
                app.mainDisplay.className = 'hero-text text-accent';
                this.state = 'input';
                app.subDisplay.innerText = "REPEAT SEQUENCE";
                return;
            }

            app.mainDisplay.innerText = "";
            
            this.timeoutId = setTimeout(() => {
                const key = this.sequence[index];
                const rotation = this.arrows[key];
                
                // Render identical character rotated
                app.mainDisplay.innerHTML = `<span style="display:inline-block; transform: rotate(${rotation})">‚Üë</span>`;
                app.mainDisplay.className = 'hero-text';
                
                this.timeoutId = setTimeout(() => {
                    this.playSequence(index + 1);
                }, 600); 
            }, 200); 
        },

        input: function(key) {
            if (this.state !== 'input') return;

            const rotation = this.arrows[key];
            if (rotation) {
                app.mainDisplay.innerHTML = `<span style="display:inline-block; transform: rotate(${rotation})">‚Üë</span>`;
            }

            if (key === this.sequence[this.userIndex]) {
                app.mainDisplay.className = 'hero-text text-success';
                this.userIndex++;

                if (this.userIndex >= this.sequence.length) {
                    this.state = 'wait';
                    this.level++;
                    setTimeout(() => {
                        app.mainDisplay.className = 'hero-text';
                        this.startLevel();
                    }, 500);
                } else {
                    setTimeout(() => {
                         if(this.state === 'input') app.mainDisplay.className = 'hero-text';
                    }, 100);
                }
            } else {
                this.endGame();
            }
        },

        endGame: function() {
            this.state = 'ended';
            app.gameLayer.className = 'active reflex-fail';
            app.mainDisplay.innerText = "GAME OVER";
            app.mainDisplay.className = 'hero-text'; 
            app.subDisplay.innerHTML = `Max Level: <span class="text-accent">${this.level}</span><br><br>Space to Retry`;
        }
    };
</script>

</body>
</html>
